name: Android News Monitor

on:
  schedule:
    - cron: '*/10 * * * *'  # 每10分钟运行一次
  workflow_dispatch:      # 允许手动点击运行测试

jobs:
  check_news:
    runs-on: ubuntu-latest
    steps:
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4

    - name: Run Monitor Script
      run: |
        python -c "
        import requests
        from bs4 import BeautifulSoup
        
        # 1. 你的 ntfy 主题名
        topic_name = 'android_news_251230' 
        
        url = 'https://mktnews.net/flash.html'
        
        try:
            headers = {'User-Agent': 'Mozilla/5.0'}
            r = requests.get(url, headers=headers)
            r.encoding = 'utf-8'
            soup = BeautifulSoup(r.text, 'html.parser')
            
            # 获取网页文字，取前200字
            content = soup.get_text(strip=True)[:200]
            
            if content:
                push_title = '市场快讯更新'
                # 发送请求到 ntfy
                requests.post(
                    f'https://ntfy.sh/{topic_name}',
                    data=content.encode('utf-8'),
                    headers={
                        'Title': push_title.encode('utf-8'),
                        'Priority': 'default'
                    }
                )
                print('推送成功！')
            else:
                print('未抓取到内容')

        except Exception as e:
            print(f'出错啦: {e}')
        "
